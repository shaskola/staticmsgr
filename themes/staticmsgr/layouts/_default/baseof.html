<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ .Title }}</title>
    <!-- Preload both font formats -->
    <link rel="preload" href="/fonts/psa-code.otf" as="font" type="font/otf" crossorigin>
    <link rel="preload" href="/fonts/psa-code.ttf" as="font" type="font/ttf" crossorigin>
    <style>
        @font-face {
            font-family: 'PSA-Code';
            src: url('/fonts/psa-code.otf') format('opentype'),
                 url('/fonts/psa-code.ttf') format('truetype');
            font-display: block;
            font-weight: normal;
            font-style: normal;
        }
    </style>
    {{ $style := resources.Get "css/main.css" | resources.Minify }}
    <link rel="stylesheet" href="{{ $style.RelPermalink }}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;700&display=swap">
    <script>
        // Font loading debug with more details
        document.fonts.ready.then(function() {
            console.log('Font loading status:');
            let psaCodeFound = false;
            document.fonts.forEach(function(font) {
                console.log(`Font: ${font.family}, Status: ${font.status}, Style: ${font.style}, Weight: ${font.weight}`);
                if (font.family === 'PSA-Code') {
                    psaCodeFound = true;
                    console.log('PSA-Code font details:', {
                        family: font.family,
                        status: font.status,
                        style: font.style,
                        weight: font.weight,
                        loaded: font.loaded,
                        display: font.display
                    });
                }
            });
            if (!psaCodeFound) {
                console.warn('PSA-Code font not found in loaded fonts! Attempting to force load...');
                // Try to force load the font
                const testDiv = document.createElement('div');
                testDiv.style.fontFamily = 'PSA-Code, monospace';
                testDiv.style.visibility = 'hidden';
                testDiv.textContent = 'Test PSA-Code Font Loading';
                document.body.appendChild(testDiv);
                
                // Check again after a short delay
                setTimeout(() => {
                    const computedFont = window.getComputedStyle(testDiv).fontFamily;
                    console.log('Computed font-family:', computedFont);
                    document.body.removeChild(testDiv);
                }, 100);
            }
        });
    </script>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="group-info">
                <img class="group-avatar" src="{{ .Site.BaseURL }}images/groupchat.jpg" alt="Group Icon">
                <h1 class="group-name">Not so secret ninjas</h1>
            </div>
            <button id="theme-toggle" class="theme-toggle">
                <img class="theme-icon moon-icon" alt="Switch to dark mode" src="{{ .Site.BaseURL }}images/heroicons-solid_moon.png">
                <img class="theme-icon sun-icon" alt="Switch to light mode" src="{{ .Site.BaseURL }}images/heroicons-solid_sun.png">
            </button>
        </header>
        <main class="content-area">
            {{ block "main" . }}{{ end }}
        </main>
        <button id="scroll-bottom" class="scroll-bottom">
            <img class="scroll-icon" alt="Scroll to bottom" src="{{ .Site.BaseURL }}images/heroicons-solid_chevron-down.png">
        </button>
    </div>
    <script>
        // Theme toggle functionality
        const themeToggle = document.getElementById('theme-toggle');
        const html = document.documentElement;
        const moonIcon = document.querySelector('.moon-icon');
        const sunIcon = document.querySelector('.sun-icon');
        
        function updateThemeIcons(theme) {
            if (theme === 'dark') {
                moonIcon.style.display = 'none';
                sunIcon.style.display = 'block';
            } else {
                moonIcon.style.display = 'block';
                sunIcon.style.display = 'none';
            }
        }
        
        // Initialize theme icons for dark mode by default
        updateThemeIcons('dark');
        
        themeToggle.addEventListener('click', () => {
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', newTheme);
            updateThemeIcons(newTheme);
        });

        // Scroll to bottom functionality
        const scrollBottom = document.getElementById('scroll-bottom');
        const contentArea = document.querySelector('.content-area');

        scrollBottom.addEventListener('click', () => {
            contentArea.scrollTo({
                top: contentArea.scrollHeight,
                behavior: 'smooth'
            });
        });

        // Auto scroll to bottom on load
        window.addEventListener('load', () => {
            contentArea.scrollTo({
                top: contentArea.scrollHeight,
                behavior: 'auto'
            });
        });

        // Load saved theme
        const savedTheme = localStorage.getItem('theme') || 'dark';
        html.setAttribute('data-theme', savedTheme);
        updateThemeIcons(savedTheme);
    </script>
</body>
</html>
